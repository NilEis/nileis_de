---
import Version from "./components/Version.astro";
import TitleAndMeta from "./components/TitleAndMeta.astro";
import LinkList from "./components/LinkList.astro";
const sites: { name: string; url: string }[] = [
  { name: "chip-8", url: "chip-8/" },
  { name: "Tower defence", url: "twd/" },
  { name: "Wave function collapse", url: "wfc/" },
  { name: "RegexToNFA", url: "regex/" },
  { name: "Voxel space", url: "voxel_space/" },
  { name: "Voxel space in wasm", url: "voxel_space_wasm/" },
  { name: "lua", url: "lua_wasm/" },
  { name: "Sonderzeichen", url: "sonderzeichen/" },
  { name: "Hackertype", url: "hackertype/" },
  { name: "Whatsapp backup viewer", url: "chat_viewer/" },
  { name: "AI", url: "ai/" },
].sort ((a, b) => a.name.localeCompare (b.name));
import { GET } from "./nasa/apod/apod.json";
const apodData = await (await GET (Astro)).json ();
---

<TitleAndMeta />
<div class="sr-only" id="bg-description"></div>
<div
  id="background"
  class={`bg-black bg-cover bg-no-repeat bg-center flex justify-center items-center h-screen w-screen`}
  aria-describedby="bg-description"
>
  <div
    class="fixed top-0 left-0 bg-gray-200 bg-opacity-25 rounded p-2"
    aria-hidden="true"
    id="title_div"
  >
  </div>
  <LinkList
    sites={sites}
    outerClass="h-screen"
    middleClass="bg-white bg-opacity-75 rounded p-4"
  >
    <Version />
  </LinkList>
  <div
    class="fixed bottom-0 left-0 bg-gray-200 bg-opacity-25 rounded p-2"
    aria-hidden="true"
    id="copyright_div"
  >
  </div>
  <div
    class="fixed bottom-0 right-0 bg-gray-200 bg-opacity-25 rounded p-2"
    aria-hidden="true"
    id="date_div"
  >
  </div>
</div>

<script type="module" define:vars={{ apodData }}>
  const image = apodData[Math.floor(Math.random() * (apodData.length - 1))];
  const backgroundImage =
    image.hdurl !== undefined ? `url("${image.hdurl}")` : "";
  const bgDescription = document.getElementById("bg-description");
  const titleDiv = document.getElementById("title_div");
  const copyRightDiv = document.getElementById("copyright_div");
  const dateDiv = document.getElementById("date_div");
  const background = document.getElementById("background");

  if (image.explanation !== undefined) {
    bgDescription.innerText = `${image.explanation}`;
  }
  if (image.title !== undefined) {
    titleDiv.innerText = image.title;
    background.ariaLabel = `background image: ${image.title}`;
  }
  if (image.copyright !== undefined) {
    copyRightDiv.innerText = `Copyright: ${image.copyright}`;
    bgDescription.innerText += `${image.copyright}`;
  }
  if (image.date !== undefined) {
    dateDiv.innerText = `Date: ${image.date}`;
    bgDescription.innerText += `${image.date}`;
  }
  background.style.backgroundImage = backgroundImage;
</script>
